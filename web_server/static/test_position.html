<!DOCTYPE html>
<html>
<head>
    <title>WebUIä½ç½®æµ‹è¯•</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #ecf0f1; }
        .test-section { margin: 20px 0; padding: 15px; background: #2c3e50; border-radius: 8px; }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        button { padding: 10px 20px; margin: 5px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2980b9; }
        pre { background: #1a252f; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ WebUI ä½ç½®æ˜¾ç¤ºæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1ï¸âƒ£ APIæµ‹è¯•</h2>
        <button onclick="testAPI()">æµ‹è¯• /api/robot/position</button>
        <pre id="api-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>
    
    <div class="test-section">
        <h2>2ï¸âƒ£ å®æ—¶ä½ç½®æ˜¾ç¤ºï¼ˆæ¨¡æ‹ŸWebUIï¼‰</h2>
        <div style="padding: 10px; background: #2c3e50; border-radius: 4px;">
            <div style="display: flex; justify-content: space-between;">
                <div>
                    <span style="color: #3498db; font-weight: bold;">ğŸ“ æœºå™¨äººä½ç½®</span>
                    <span id="robot-coords" style="color: #ecf0f1; margin-left: 1em;">X: 0.000 | Y: 0.000 | Yaw: 0.000Â°</span>
                </div>
                <div style="color: #95a5a6; font-size: 0.85em;" id="robot-frame">Frame: unknown</div>
            </div>
        </div>
        <button onclick="startAutoUpdate()">å¼€å§‹è‡ªåŠ¨æ›´æ–°ï¼ˆ5Hzï¼‰</button>
        <button onclick="stopAutoUpdate()">åœæ­¢è‡ªåŠ¨æ›´æ–°</button>
        <p id="update-status">çŠ¶æ€ï¼šæœªå¯åŠ¨</p>
    </div>
    
    <div class="test-section">
        <h2>3ï¸âƒ£ è°ƒè¯•ä¿¡æ¯</h2>
        <pre id="debug-log">ç­‰å¾…è°ƒè¯•ä¿¡æ¯...</pre>
    </div>

    <script>
        let updateInterval = null;
        let updateCount = 0;
        
        async function testAPI() {
            const resultEl = document.getElementById('api-result');
            resultEl.textContent = 'æ­£åœ¨è·å–...';
            
            try {
                const response = await fetch('/api/robot/position');
                const data = await response.json();
                
                resultEl.innerHTML = `<span class="success">âœ… APIå“åº”æˆåŠŸ</span>\n\n${JSON.stringify(data, null, 2)}`;
                
                // åŒæ—¶æ›´æ–°æ˜¾ç¤º
                updateDisplay(data);
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ APIè¯·æ±‚å¤±è´¥</span>\n\n${error.message}`;
            }
        }
        
        function updateDisplay(data) {
            const coordsElement = document.getElementById('robot-coords');
            const frameElement = document.getElementById('robot-frame');
            const debugLog = document.getElementById('debug-log');
            
            if (!data) {
                coordsElement.textContent = 'X: -- | Y: -- | Yaw: --Â°';
                coordsElement.style.color = '#95a5a6';
                frameElement.textContent = 'Frame: unknown';
                frameElement.style.color = '#95a5a6';
                
                debugLog.innerHTML += `<span class="error">[${new Date().toLocaleTimeString()}] æ— æ•°æ®</span>\n`;
                return;
            }
            
            const yawDeg = (data.yaw * 180 / Math.PI).toFixed(1);
            
            coordsElement.textContent = `X: ${data.x.toFixed(3)} | Y: ${data.y.toFixed(3)} | Yaw: ${yawDeg}Â°`;
            coordsElement.style.color = '#2ecc71';
            
            frameElement.textContent = `Frame: ${data.frame_id || 'unknown'}`;
            frameElement.style.color = '#3498db';
            
            debugLog.innerHTML += `<span class="success">[${new Date().toLocaleTimeString()}] ä½ç½®æ›´æ–° #${updateCount}: x=${data.x.toFixed(3)}, y=${data.y.toFixed(3)}, yaw=${yawDeg}Â°, frame=${data.frame_id}</span>\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        async function fetchAndUpdate() {
            try {
                updateCount++;
                const response = await fetch('/api/robot/position');
                if (response.ok) {
                    const data = await response.json();
                    updateDisplay(data);
                } else {
                    document.getElementById('debug-log').innerHTML += `<span class="error">[${new Date().toLocaleTimeString()}] APIè¿”å›é”™è¯¯: ${response.status}</span>\n`;
                }
            } catch (error) {
                document.getElementById('debug-log').innerHTML += `<span class="error">[${new Date().toLocaleTimeString()}] è·å–å¤±è´¥: ${error.message}</span>\n`;
            }
        }
        
        function startAutoUpdate() {
            if (updateInterval) {
                alert('å·²ç»åœ¨è¿è¡Œäº†');
                return;
            }
            
            updateCount = 0;
            document.getElementById('debug-log').innerHTML = '';
            document.getElementById('update-status').innerHTML = '<span class="success">çŠ¶æ€ï¼šè¿è¡Œä¸­ï¼ˆ5Hzï¼‰</span>';
            
            // 5Hzæ›´æ–°
            updateInterval = setInterval(fetchAndUpdate, 200);
            fetchAndUpdate(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        }
        
        function stopAutoUpdate() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
                document.getElementById('update-status').innerHTML = '<span class="error">çŠ¶æ€ï¼šå·²åœæ­¢</span>';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(testAPI, 500);
        });
    </script>
</body>
</html>

